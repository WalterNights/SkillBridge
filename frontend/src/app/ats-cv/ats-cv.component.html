<!-- Loading State -->
<div *ngIf="isLoading" class="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-dark-bg-primary">
  <div class="text-center">
    <div class="w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
    <p class="text-gray-600 dark:text-dark-text-secondary">Cargando CV...</p>
  </div>
</div>

<!-- Error State -->
<div *ngIf="!isLoading && errorMessage" class="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-dark-bg-primary px-4">
  <div class="text-center">
    <svg class="w-16 h-16 text-error-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
    </svg>
    <p class="text-gray-800 dark:text-dark-text-primary text-lg font-semibold mb-2">{{ errorMessage }}</p>
    <button (click)="goToResults()" class="mt-4 px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">
      Ir a Ofertas
    </button>
  </div>
</div>

<!-- CV Content -->
<div *ngIf="!isLoading && !errorMessage && profileData" class="min-h-screen bg-gray-100 dark:bg-dark-bg-primary px-4" style="padding-top: 120px; padding-bottom: 60px;">
  <!-- Action Buttons -->
  <div class="cv-container mx-auto mb-6 flex justify-end gap-4">
    <button
      (click)="downloadCV()"
      class="px-6 py-3 bg-white dark:bg-dark-bg-tertiary border border-gray-300 dark:border-dark-border rounded-lg shadow-sm hover:shadow-md transition-all flex items-center gap-2 text-gray-700 dark:text-dark-text-primary font-medium"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      Descargar CV
    </button>
    <button
      (click)="goToResults()"
      class="px-6 py-3 bg-primary-600 dark:bg-primary-500 text-white rounded-lg shadow-sm hover:shadow-md hover:bg-primary-700 dark:hover:bg-primary-600 transition-all flex items-center gap-2 font-medium"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
      </svg>
      Ver Ofertas
    </button>
  </div>

  <!-- ATS-Optimized CV - A4 Size -->
  <div #cvContent class="cv-page">
    <!-- Header Section -->
    <header class="cv-header">
      <h1 class="cv-name">{{ profileData.first_name }} {{ profileData.last_name }}</h1>
      <div class="cv-contact">
        <span *ngIf="profileData.city">{{ profileData.city }}, {{ profileData.country || 'Colombia' }}</span>
        <span *ngIf="profileData.linkedin_url" class="cv-contact-separator">|</span>
        <span *ngIf="profileData.linkedin_url">{{ profileData.linkedin_url }}</span>
        <span *ngIf="profileData.phone_number" class="cv-contact-separator">|</span>
        <span *ngIf="profileData.phone_number">{{ profileData.phone_code }} {{ profileData.phone_number }}</span>
        <span *ngIf="profileData.email" class="cv-contact-separator">|</span>
        <span *ngIf="profileData.email">{{ profileData.email }}</span>
      </div>
    </header>

    <!-- Professional Summary -->
    <section *ngIf="profileData.summary" class="cv-section">
      <p class="cv-summary">{{ profileData.summary }}</p>
    </section>

    <!-- Professional Experience -->
    <section *ngIf="profileData.experience" class="cv-section">
      <h2 class="cv-section-title">EXPERIENCIA PROFESIONAL</h2>

      <!-- Array format (from CV analysis) -->
      <div *ngIf="isExperienceArray()" class="cv-entries">
        <div *ngFor="let exp of profileData.experience" class="cv-entry">
          <div class="cv-entry-header">
            <div class="cv-entry-left">
              <h3 class="cv-entry-title">{{ exp.company }}</h3>
              <p class="cv-entry-subtitle">{{ exp.position }}</p>
            </div>
            <div class="cv-entry-right">
              <span class="cv-entry-location">{{ exp.location_city }}<span *ngIf="exp.location_country">, {{ exp.location_country }}</span></span>
              <span class="cv-entry-date">{{ exp.start_date }} - {{ exp.end_date }}</span>
            </div>
          </div>
          <ul *ngIf="exp.description" class="cv-entry-list">
            <li>{{ exp.description }}</li>
          </ul>
        </div>
      </div>

      <!-- String format (manual input) -->
      <div *ngIf="!isExperienceArray()" class="cv-text-content">
        {{ profileData.experience }}
      </div>
    </section>

    <!-- Education -->
    <section *ngIf="profileData.education" class="cv-section">
      <h2 class="cv-section-title">EDUCACION</h2>

      <!-- Array format (from CV analysis) -->
      <div *ngIf="isEducationArray()" class="cv-entries">
        <div *ngFor="let edu of profileData.education" class="cv-entry">
          <div class="cv-entry-header">
            <div class="cv-entry-left">
              <h3 class="cv-entry-title">{{ edu.institution }}</h3>
              <p class="cv-entry-subtitle">{{ edu.title }}</p>
            </div>
            <div class="cv-entry-right">
              <span class="cv-entry-location">{{ edu.location_city }}<span *ngIf="edu.location_country">, {{ edu.location_country }}</span></span>
              <span class="cv-entry-date">{{ edu.start_date }} - {{ edu.end_date }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- String format (manual input) -->
      <div *ngIf="!isEducationArray()" class="cv-text-content">
        {{ profileData.education }}
      </div>
    </section>

    <!-- Technical Skills -->
    <section *ngIf="profileData.skills" class="cv-section">
      <h2 class="cv-section-title">SKILLS</h2>
      <p class="cv-skills">{{ profileData.skills }}</p>
    </section>

  </div>
</div>
